% Introduction Chapter

\iffalse
FIXME: TODO REMOVE THIS LIST
\begin{itemize}
\item INTRODUCTION: The Setting - bird eye's view - the challenge to be tackled / thing to be be improved in general
\item INTRODUCTION: Past research done
\item INTRODUCTION: Gap in knowledge/problem not yet solved
\item INTRODUCTION: Purpose and method of this work
\item INTRODUCTION: More detailed description what was done
\item INTRODUCTION: Results acquired
\item INTRODUCTION: Analysis and limitations of the result (Mostly relocate to Conclusions)
\item INTRODUCTION: Value (Mostly relocate to Conclusions)
\end{itemize}
\fi

Loading operating system into computer remotely over network
(``network booting'', ``diskless booting'') has been used for
decades. Network booting can be used to bootstrap operating system
installation (``network installation'') or it could be used for
diskless nodes to load the operating system and run it using disk
provided by server.

Usually network installation systems are built to serve single
organization (e.g.\ single business) inside their own networks
(``intranets'') to achieve repeatable and homogeneous
installations. Installation preferably should be as easy and as fast
as possible.

Many Linux distributions offer ``net install'' where a small image is
used to boot the computer into a state where rest of the installation
software and packages can be downloaded directly from Internet.

This thesis looks at history of installation systems, then identifies
what network based threats there are and studies how to protect the
installation process using readily available tools and components.

After introduction, in next chapter discusses about a proof of concept
implementation of network installation system and it's design
principles.

Then before discussion and conclusion, the proof of concept
implementation is compared against to two other installation systems.

\section{Protocols}

Multiple protocols have been developed and used in combination to
allow booting using IP network. Early published standards include RARP
(``A Reverse Address Resolution Protocol'', RFC903, published
1984~\cite{RFC903}) and BOOTP (``Bootstrap Protocol'', RFC951,
published 1985~\cite{RFC951}) could be used to allow ``a diskless
client machine to discover its own IP address''~\cite{RFC951}, TFTP
(``Trivial File Transfer Protocol'', RFC783, published
1981~\cite{RFC783}) ``may be used to move files between machines on
different networks implementing UDP.''~\cite{RFC783}.

Later developments include RARP and BOOTP to be superseded by DHCP
(``Dynamic Host Configuration Protocol'', RFC1531, published
1993~\cite{RFC1531}) and TFTP superseded by NFS (``Network File
System'', RFC1094, published 1989~\cite{RFC1094}) which ``provides
transparent remote access to shared files across
networks.''~\cite{RFC1094} PXE (``Preboot Execution
Environment''~\cite{PXEspec}) is specification from Intel Corporation
to standardize preboot environment for network booting.


\section{Current state}

Alpine Linux's PXE Boot HOWTO~\cite{alpine-pxe-boot-howto} summarizes
the current situation:

\begin{quote}
Alpine can be PXE booted starting with Alpine 2.6-rc2. In order to
accomplish this you must complete the following steps:

\begin{itemize}
\item Set up a DHCP server and configure it to support PXE boot.
\item Set up a TFTP server to serve the PXE boot loader.
\item Set up an HTTP server to serve the rest of the boot files.
\item Set up an NFS server from which Alpine can load kernel modules.
\item Configure mkinitfs to generate a PXE-bootable initrd.
\end{itemize}
\end{quote}

As we can see, the whole process still relies on old protocols DHCP,
TFTP, HTTP and NFS developed around 1980--1990. However, these
protocols provide no security and should not be used in networks.

TFTP, NFS and HTTP protocols can be replaced with HTTPS (HTTP over
TLS) where TLS protocol provides communications security using
cryptography and authentication of one or both communicating parties.

DHCP is de facto standard to achieve zero configuration and it's
difficult to replace so it's shortcomings need to be countered with
other protocols.

\section{Challenging environments}

Computer networks are not safe nor secure. Internet being the most
unsafe of networks. Connections in the internet do not see national
borders and travel through different areas of laws and
regulations. Protocol packets are passed from one internet service
provider to another. On every step of the connection someone might be
listening or even altering the connection to ones own agendas. It
might be governmental body (like NSA's PRISM
program~\cite{nsa-prism}), criminal organization who have gained
foothold on point of network or simply curious individual just being
able to do so.

Same problems can also be present in networks like corporate
intranets, etc. where both government and criminal organizations might
have gained foothold to operate. In USENIX Enigma 2016 conference Rob
Joyce, Chief of Tailored Access Operations in National Security
Agency~\cite{nsa-tao} describes how his team infiltrates networks and
moves there laterally to gain what they are after. Because of this
intranets should be treated with same level of mistrust as internet.


\section{Threats}

CIA triad divides network security into three elements:
confidentiality, integrity and availability.

Confidentiality means sender of the message encrypts the content so
only receiver with correct key can decrypt the content and see the
message.

Integrity control guarantees that message cannot be modified during
transfer. It consist two parts: Non-repudiation and
authenticity.

Non-repudiation ensures proof of integrity and the origin of
data. This is usually achieved with using authentication and integrity
control.

Authenticity ensures receiving, transmitting or both parties determine
they are communicating with intended party before exchanging any
confidential messages.

Availability means that the systems are up and operational.

Threats can be identified in all components from hardware to operating
system vulnerabilities. Table~\ref{tab:threats_table} lists some
common known attacks which could be targeted towards network booting
or network installation systems.

\begin{table}[!ht]
  % Add some padding to the table cells:
  \def\arraystretch{1.1}%
  \begin{center}
   \caption{Roles and threats of various components used in operating
      system installation over network}
    \begin{tabular}{| l | l | l |}
      \hline
      Component   & Role               & Threat(s)                  \\
      \hline
      HTTP        & File transfer      & confidentiality, integrity \\
      DNS         & Name service       & non-repudiation            \\
      NFS         & File transfer      & confidentiality, integrity \\
      TFTP        & File transfer      & confidentiality, integrity \\
      DHCP        & Zero configuration & non-repudiation            \\
      \hline
    \end{tabular}
    \label{tab:threats_table}
  \end{center}
\end{table}

DHCP and DNS protocols could be used to redirect (``hijack'') future
communications into malicious services. DHCP is commonly used to
assign IP address to client and give various information (TFTP
server's IP address, DNS servers' IP addresses). Malicious DHCP could
take over future TFTP and DNS communications. DNS has many uses, but
commonly it's used to translate host name into IP address. Malicious
DNS server could redirect future communications into malicious
services.

TFTP, NFS and HTTP protocols could be used to deliver malicious files
which when executed in target system compromise the operating system
installation or even infect the hardware the operation was performed
in.

There has been development to secure DHCP and DNS. That however
requires the network in question to be configured to take these
security measurements in action. But the threats can be detected by
other components (e.g.\ using TLS's server authentication, and file
signatures) so there's no need to changes to network
configuration. Thus the installation can be done securely in any
network and if something malicious is detected the installation
process can halted.

Hardware (e.g.\ physical server or laptop) and peripherals (e.g.\
displays, keyboards, mice, removable medias) can have backdoored
firmware. The backdoors could have been installed already on factory
or firmware was infected with some malware previously ran on the
machine. Discussing mitigations for threats against hardware is out of
scope of this work.


\section{Mitigation}

Threats can be mitigated by using trusted media, secure communication
channel and cryptographically signed files.

Boot environment is loaded from trusted media, for example using
prebuilt USB mass media. This media contains software and files to
safely load next steps required to load operating system kernel and
other files safely over network.

Network communication is done using HTTPS with X.509 certificate
pinning. This authenticates the remote server and makes it harder to
MitM attack the connection. If secure channel can't be opened, the
boot process should be halted.

Signed files are used to ensure authenticity of files used for
booting. For example many Linux distribution mirrors only provide
files via HTTP or FTP servers which are susceptible to MITM attack. If
signature check fails the boot process should be halted.
